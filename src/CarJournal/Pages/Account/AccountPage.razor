@page "/account"
@using System.ComponentModel.DataAnnotations
@attribute [Authorize(Roles = "user")]

@inject IAccountService _accountService
@inject IClientAuthenticationService _authService

<MudStack Style="max-width: 500px;">
    <MudText>
        @CurrentAccountEmail
    </MudText>

    <MudTextField
        @bind-Value="@NewAccountEmail"
        For="@(() => NewAccountEmail)"
        Label="New Mail"
        Variant="Variant.Outlined"/>

    <MudButton
        Color="Color.Warning"
        Variant="Variant.Filled">
        Change Email
    </MudButton>
</MudStack>

<MudStack Style="max-width: 500px;">
    
</MudStack>

@code {
    [EmailAddress]
    private string NewAccountEmail { get; set; } = string.Empty;

    private string CurrentAccountEmail { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var userId = await _authService.GetUserIdAsync();

        if(string.IsNullOrEmpty(userId))
        {
            return;
        }

        CurrentAccountEmail = await _accountService
            .GetEmailByUserId(Convert.ToInt32(userId));        
    }
}